(()=>{var e={52(e){e.exports=e=>{const t=[],n=[],o=[],r=[],a=[];return e.blocks&&e.blocks.forEach(i=>{i.paragraphs.forEach(t=>{t.lines.forEach(n=>{n.words.forEach(o=>{o.symbols.forEach(r=>{a.push({...r,page:e,block:i,paragraph:t,line:n,word:o})}),r.push({...o,page:e,block:i,paragraph:t,line:n})}),o.push({...n,page:e,block:i,paragraph:t})}),n.push({...t,page:e,block:i})}),t.push({...i,page:e})}),{...e,blocks:t,paragraphs:n,lines:o,words:r,symbols:a}}},88(e){e.exports=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`},121(e){e.exports={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}},185(e){"use strict";e.exports={rE:"5.1.1"}},244(e){e.exports=({workerPath:e,workerBlobURL:t})=>{let n;if(Blob&&URL&&t){const t=new Blob([`importScripts("${e}");`],{type:"application/javascript"});n=new Worker(URL.createObjectURL(t))}else n=new Worker(e);return n}},251(e){e.exports=async(e,t)=>{e.postMessage(t)}},269(e,t,n){const o=n(612),r=n(244),a=n(272),i=n(993),l=n(251),s=n(760);e.exports={defaultOptions:o,spawnWorker:r,terminateWorker:a,onMessage:i,send:l,loadImage:s}},272(e){e.exports=e=>{e.terminate()}},394(e){e.exports={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}},421(e,t,n){const o=n(905);e.exports={recognize:async(e,t,n)=>{const r=await o(t,1,n);return r.recognize(e).finally(async()=>{await r.terminate()})},detect:async(e,t)=>{const n=await o("osd",0,t);return n.detect(e).finally(async()=>{await n.terminate()})}}},466(e){e.exports={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}},472(e,t,n){const o=n(88);let r=0;e.exports=({id:e,action:t,payload:n={}})=>{let a=e;return void 0===a&&(a=o("Job",r),r+=1),{id:a,action:t,payload:n}}},473(e){var t=function(e){"use strict";var t,n=Object.prototype,o=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function d(e,t,n,o){var a=t&&t.prototype instanceof f?t:f,i=Object.create(a.prototype),l=new A(o||[]);return r(i,"_invoke",{value:L(e,n,l)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var u="suspendedStart",y="suspendedYield",h="executing",m="completed",g={};function f(){}function x(){}function w(){}var b={};c(b,i,function(){return this});var v=Object.getPrototypeOf,C=v&&v(v(T([])));C&&C!==n&&o.call(C,i)&&(b=C);var E=w.prototype=f.prototype=Object.create(b);function S(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){function n(r,a,i,l){var s=p(e[r],e,a);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==typeof d&&o.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,i,l)},function(e){n("throw",e,i,l)}):t.resolve(d).then(function(e){c.value=e,i(c)},function(e){return n("throw",e,i,l)})}l(s.arg)}var a;r(this,"_invoke",{value:function(e,o){function r(){return new t(function(t,r){n(e,o,t,r)})}return a=a?a.then(r,r):r()}})}function L(e,t,n){var o=u;return function(r,a){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===r)throw a;return j()}for(n.method=r,n.arg=a;;){var i=n.delegate;if(i){var l=R(i,n);if(l){if(l===g)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===u)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var s=p(e,t,n);if("normal"===s.type){if(o=n.done?m:y,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=m,n.method="throw",n.arg=s.arg)}}}function R(e,n){var o=n.method,r=e.iterator[o];if(r===t)return n.delegate=null,"throw"===o&&e.iterator.return&&(n.method="return",n.arg=t,R(e,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),g;var a=p(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function T(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function n(){for(;++r<e.length;)if(o.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:j}}function j(){return{value:t,done:!0}}return x.prototype=w,r(E,"constructor",{value:w,configurable:!0}),r(w,"constructor",{value:x,configurable:!0}),x.displayName=c(w,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},S(k.prototype),c(k.prototype,l,function(){return this}),e.AsyncIterator=k,e.async=function(t,n,o,r,a){void 0===a&&(a=Promise);var i=new k(d(t,n,o,r),a);return e.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})},S(E),c(E,s,"Generator"),c(E,i,function(){return this}),c(E,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(o,r){return l.type="throw",l.arg=e,n.next=o,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;I(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,o){return this.delegate={iterator:T(e),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},528(e,t,n){const o=n(529);e.exports=e=>{const t={};return"undefined"!=typeof WorkerGlobalScope?t.type="webworker":o()?t.type="electron":"object"==typeof document?t.type="browser":"object"==typeof process&&(t.type="node"),void 0===e?t:t[e]}},529(e){e.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}},612(e,t,n){const o=n(185).rE,r=n(952);e.exports={...r,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${o}/dist/worker.min.js`}},655(e,t,n){n(473);const o=n(750),r=n(905),a=n(421),i=n(394),l=n(466),s=n(121),{setLogging:c}=n(863);e.exports={languages:i,OEM:l,PSM:s,createScheduler:o,createWorker:r,setLogging:c,...a}},750(e,t,n){const o=n(472),{log:r}=n(863),a=n(88);let i=0;e.exports=()=>{const e=a("Scheduler",i),t={},n={};let l=[];i+=1;const s=()=>Object.keys(t).length,c=()=>{if(0!==l.length){const e=Object.keys(t);for(let o=0;o<e.length;o+=1)if(void 0===n[e[o]]){l[0](t[e[o]]);break}}},d=(t,a)=>new Promise((i,s)=>{const d=o({action:t,payload:a});l.push(async e=>{l.shift(),n[e.id]=d;try{i(await e[t].apply(this,[...a,d.id]))}catch(e){s(e)}finally{delete n[e.id],c()}}),r(`[${e}]: Add ${d.id} to JobQueue`),r(`[${e}]: JobQueue length=${l.length}`),c()});return{addWorker:n=>(t[n.id]=n,r(`[${e}]: Add ${n.id}`),r(`[${e}]: Number of workers=${s()}`),c(),n.id),addJob:async(t,...n)=>{if(0===s())throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return d(t,n)},terminate:async()=>{Object.keys(t).forEach(async e=>{await t[e].terminate()}),l=[]},getQueueLen:()=>l.length,getNumWorkers:s}}},760(e){const t=e=>new Promise((t,n)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=({target:{error:{code:e}}})=>{n(Error(`File could not be read! Code=${e}`))},o.readAsArrayBuffer(e)}),n=async e=>{let o=e;if(void 0===e)return"undefined";if("string"==typeof e)if(/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e))o=atob(e.split(",")[1]).split("").map(e=>e.charCodeAt(0));else{const t=await fetch(e);o=await t.arrayBuffer()}else if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)"IMG"===e.tagName&&(o=await n(e.src)),"VIDEO"===e.tagName&&(o=await n(e.poster)),"CANVAS"===e.tagName&&await new Promise(n=>{e.toBlob(async e=>{o=await t(e),n()})});else if("undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas){const n=await e.convertToBlob();o=await t(n)}else(e instanceof File||e instanceof Blob)&&(o=await t(e));return new Uint8Array(o)};e.exports=n},863(e,t){let n=!1;t.logging=n,t.setLogging=e=>{n=e},t.log=(...e)=>n?console.log.apply(this,e):null},905(e,t,n){const o=n(977),r=n(52),a=n(472),{log:i}=n(863),l=n(88),s=n(466),{defaultOptions:c,spawnWorker:d,terminateWorker:p,onMessage:u,loadImage:y,send:h}=n(269);let m=0;e.exports=async(e="eng",t=s.LSTM_ONLY,n={},g={})=>{const f=l("Worker",m),{logger:x,errorHandler:w,...b}=o({...c,...n}),v={},C={},E="string"==typeof e?e.split("+"):e;let S=t,k=g;const L=[s.DEFAULT,s.LSTM_ONLY].includes(t)&&!b.legacyCore;let R,O;const I=new Promise((e,t)=>{O=e,R=t});let A=d(b);A.onerror=e=>{R(e.message)},m+=1;const T=(e,t)=>{v[e]=t},j=(e,t)=>{C[e]=t},N=({id:e,action:t,payload:n})=>new Promise((o,r)=>{i(`[${f}]: Start ${e}, action=${t}`);const a=`${t}-${e}`;T(a,o),j(a,r),h(A,{workerId:f,jobId:e,action:t,payload:n})}),_=(e,t)=>N(a({id:t,action:"loadLanguage",payload:{langs:e,options:{langPath:b.langPath,dataPath:b.dataPath,cachePath:b.cachePath,cacheMethod:b.cacheMethod,gzip:b.gzip,lstmOnly:[s.DEFAULT,s.LSTM_ONLY].includes(S)&&!b.legacyLang}}})),D=(e,t,n,o)=>N(a({id:o,action:"initialize",payload:{langs:e,oem:t,config:n}}));u(A,({workerId:e,jobId:t,status:n,action:o,data:a})=>{const l=`${o}-${t}`;if("resolve"===n){i(`[${e}]: Complete ${t}`);let n=a;"recognize"===o?n=r(a):"getPDF"===o&&(n=Array.from({...a,length:Object.keys(a).length})),v[l]({jobId:t,data:n})}else if("reject"===n){if(C[l](a),"load"===o&&R(a),!w)throw Error(a);w(a)}else"progress"===n&&x({...a,userJobId:t})});const M={id:f,worker:A,setResolve:T,setReject:j,load:()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),writeText:(e,t,n)=>N(a({id:n,action:"FS",payload:{method:"writeFile",args:[e,t]}})),readText:(e,t)=>N(a({id:t,action:"FS",payload:{method:"readFile",args:[e,{encoding:"utf8"}]}})),removeFile:(e,t)=>N(a({id:t,action:"FS",payload:{method:"unlink",args:[e]}})),FS:(e,t,n)=>N(a({id:n,action:"FS",payload:{method:e,args:t}})),loadLanguage:()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),initialize:()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),reinitialize:(e="eng",t,n,o)=>{if(L&&[s.TESSERACT_ONLY,s.TESSERACT_LSTM_COMBINED].includes(t))throw Error("Legacy model requested but code missing.");const r=t||S;S=r;const a=n||k;k=a;const i=("string"==typeof e?e.split("+"):e).filter(e=>!E.includes(e));return E.push(...i),i.length>0?_(i,o).then(()=>D(e,r,a,o)):D(e,r,a,o)},setParameters:(e={},t)=>N(a({id:t,action:"setParameters",payload:{params:e}})),recognize:async(e,t={},n={blocks:!0,text:!0,hocr:!0,tsv:!0},o)=>N(a({id:o,action:"recognize",payload:{image:await y(e),options:t,output:n}})),getPDF:(e="Tesseract OCR Result",t=!1,n)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),N(a({id:n,action:"getPDF",payload:{title:e,textonly:t}}))),detect:async(e,t)=>{if(L)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return N(a({id:t,action:"detect",payload:{image:await y(e)}}))},terminate:async()=>(null!==A&&(p(A),A=null),Promise.resolve())};return N(a({id:undefined,action:"load",payload:{options:{lstmOnly:L,corePath:b.corePath,logging:b.logging}}})).then(()=>_(e)).then(()=>D(e,t,g)).then(()=>O(M)).catch(()=>{}),I}},952(e){e.exports={workerBlobURL:!0,logger:()=>{}}},977(e,t,n){const o="browser"===n(528)("type")?e=>new URL(e,window.location.href).href:e=>e;e.exports=e=>{const t={...e};return["corePath","workerPath","langPath"].forEach(n=>{e[n]&&(t[n]=o(t[n]))}),t}},993(e){e.exports=(e,t)=>{e.onmessage=({data:e})=>{t(e)}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}(()=>{"use strict";var e=n(655);function t(e,t="110px",n="32px",o=null){const r=document.createElement("button");return r.textContent=e,r.style.width=t,r.style.height=n,r.style.padding="4px 8px",r.style.backgroundColor="#374151",r.style.color="#f9fafb",r.style.border="1px solid #4b5563",r.style.borderRadius="6px",r.style.cursor="pointer",r.style.fontSize="14px",r.style.fontWeight="600",r.style.fontFamily="Inter, sans-serif",r.style.transition="all 0.2s ease",r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.dataset.origBg=r.style.backgroundColor,r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#4b5563",r.style.transform="translateY(-1px)",r.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=r.dataset.origBg||r.style.backgroundColor,r.style.transform="translateY(0)",r.style.boxShadow="none"}),r.addEventListener("mousedown",()=>{r.style.transform="translateY(1px) scale(0.98)"}),r.addEventListener("mouseup",()=>{r.style.transform="translateY(-1px)"}),o&&r.addEventListener("click",o),r}function o(e){return e.replace(/1/g,"I").replace(/5/g,"S").replace(/0/g,"O").replace(/2/g,"Z").replace(/3/g,"E").replace(/4/g,"A").replace(/6/g,"G").replace(/7/g,"T").replace(/8/g,"B").replace(/9/g,"g")}function r(){if(document.getElementById("ocr-settings-panel"))return;const e=document.createElement("div");e.id="ocr-settings-backdrop",Object.assign(e.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0,0,0,0.45)",zIndex:"1000000",opacity:"0",transition:"opacity 220ms ease"});const t=document.createElement("aside");t.id="ocr-settings-panel",Object.assign(t.style,{position:"fixed",top:"0",left:"0",height:"100vh",width:"min(420px, 90vw)",backgroundColor:"#0f1724",color:"#f9fafb",boxShadow:"2px 0 30px rgba(0,0,0,0.6)",zIndex:"1000001",transform:"translateX(-100%)",transition:"transform 320ms cubic-bezier(.2,.9,.2,1)",overflowY:"auto",padding:"20px",boxSizing:"border-box",fontFamily:"Inter, sans-serif"});const n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="space-between",n.style.marginBottom="12px";const o=document.createElement("h2");o.textContent="Settings",o.style.margin="0",o.style.fontSize="18px";const r=document.createElement("button");r.textContent="âœ•",Object.assign(r.style,{background:"transparent",border:"none",color:"#f9fafb",fontSize:"20px",cursor:"pointer"});const a=document.createElement("div");a.style.color="#9ca3af",a.style.fontSize="12px",a.style.marginLeft="8px";try{a.textContent=new URL(window.location.href).hostname||"current site"}catch(e){a.textContent="current site"}const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="12px",i.appendChild(o),i.appendChild(a),n.appendChild(i),n.appendChild(r),t.appendChild(n);const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.gap="8px",l.style.margin="8px 0 12px 0";const s=document.createElement("div");s.style.display="flex",s.style.margin="8px 0 0 ",s.style.alignItems="center",s.style.gap="6px",s.style.flex="1";const c=document.createElement("label");c.textContent="Rule Scope",c.style.color="#e6eef8",c.style.fontSize="13px";const d=document.createElement("select");d.id="rule_scope";const p=document.createElement("option");p.value="global",p.textContent="Global Rules",d.appendChild(p),Object.assign(d.style,{padding:"6px",background:"#0b1220",color:"#e6eef8",border:"1px solid #25303a",borderRadius:"6px",minWidth:"160px",margin:"0 auto"}),s.appendChild(c),s.appendChild(d);const u=document.createElement("div");u.style.display="flex",u.style.alignItems="center",u.style.gap="8px";const y=document.createElement("button");y.textContent="+",Object.assign(y.style,{padding:"6px 8px",borderRadius:"6px",border:"none",background:"#4f46e5",color:"#fff",cursor:"pointer"});const h=document.createElement("button");h.textContent="ðŸ—‘ï¸",Object.assign(h.style,{padding:"6px 8px",borderRadius:"6px",border:"none",background:"#ef4444",color:"#fff",cursor:"pointer"}),u.appendChild(y),u.appendChild(h),l.appendChild(s),l.appendChild(u),t.appendChild(l);const m=document.createElement("div");m.style.display="flex",m.style.flexDirection="column",m.style.gap="14px";const g=document.createElement("section");Object.assign(g.style,{background:"#111827",padding:"12px",borderRadius:"8px"});const f=document.createElement("h3");f.textContent="Find & Replace Rules",f.style.margin="0 0 8px 0";const x=document.createElement("div");x.textContent="Characters/words to replace in the OCR text",x.style.color="#9ca3af",x.style.fontSize="13px",x.style.marginBottom="10px";const w=document.createElement("div");w.style.display="flex",w.style.flexDirection="column",w.style.gap="8px";const b=document.createElement("div");b.style.display="flex",b.style.gap="12px",b.style.alignItems="center",b.style.flexWrap="wrap",b.style.margin="0 auto";const v=document.createElement("input");v.placeholder="Character to Find",Object.assign(v.style,{width:"150px",padding:"8px",borderRadius:"6px",background:"#0b1220",color:"#e6eef8",border:"1px solid #25303a"});const C=document.createElement("input");C.placeholder="Replace With",Object.assign(C.style,{width:"150px",padding:"8px",borderRadius:"6px",background:"#0b1220",color:"#e6eef8",border:"1px solid #25303a"});const E=document.createElement("div");E.textContent="â†’",E.style.color="#9ca3af",E.style.fontSize="18px",E.style.display="flex",E.style.alignItems="center",E.style.padding="0 4px",b.appendChild(v),b.appendChild(E),b.appendChild(C);const S=document.createElement("div");S.style.color="#f87171",S.style.fontSize="12px",S.style.marginTop="6px",S.style.display="none",S.textContent="";const k=document.createElement("button");k.textContent="Add",Object.assign(k.style,{padding:"8px 10px",borderRadius:"6px",border:"none",background:"#4f46e5",color:"#fff",cursor:"pointer",width:"72px",alignSelf:"center"}),w.appendChild(b),w.appendChild(S),w.appendChild(k);const L=document.createElement("div");L.style.marginTop="8px",L.style.display="grid",L.style.gridTemplateColumns="1fr 1fr",L.style.gap="8px";const R=document.createElement("h4");R.textContent="Characters to Delete",R.style.margin="12px 0 6px 0",R.style.fontSize="15px";const O=document.createElement("div");O.textContent="These characters will be removed from the OCR text",O.style.color="#9ca3af",O.style.fontSize="13px";const I=document.createElement("div");I.style.display="flex",I.style.gap="8px",I.style.alignItems="center",I.style.marginTop="8px";const A=document.createElement("input");A.placeholder="Character to Delete",Object.assign(A.style,{flex:"1",padding:"8px",borderRadius:"6px",background:"#0b1220",color:"#e6eef8",border:"1px solid #25303a"});const T=document.createElement("button");T.textContent="Add",Object.assign(T.style,{padding:"8px 10px",borderRadius:"6px",border:"none",background:"#4f46e5",color:"#fff",cursor:"pointer",width:"72px",flex:"0 0 auto"}),I.appendChild(A),I.appendChild(T);const j=document.createElement("div");j.style.marginTop="8px",j.style.display="flex",j.style.flexWrap="wrap",j.style.gap="6px",g.appendChild(f),g.appendChild(x),g.appendChild(w),g.appendChild(L),g.appendChild(R),g.appendChild(O),g.appendChild(I),g.appendChild(j);const N=document.createElement("section");Object.assign(N.style,{background:"#111827",padding:"12px",borderRadius:"8px",display:"flex",gap:"8px",justifyContent:"center"});const _=document.createElement("button");_.textContent="ðŸ“¥ Import Settings";const D=document.createElement("button");D.textContent="ðŸ“¤ Export Settings",[_,D].forEach(e=>Object.assign(e.style,{padding:"8px 12px",borderRadius:"6px",border:"none",background:"#4f46e5",color:"#fff",cursor:"pointer"}));const M=document.createElement("input");M.type="file",M.accept="application/json",M.style.display="none",N.appendChild(_),N.appendChild(D),N.appendChild(M);const z=document.createElement("section");Object.assign(z.style,{background:"#111827",padding:"12px",borderRadius:"8px"});const P=document.createElement("h3");P.textContent="Copy Function Configuration",P.style.margin="0 0 8px 0";const U=document.createElement("p");U.textContent="When checked, clicking the action will also copy the resulting text to clipboard.",U.style.color="#9ca3af",U.style.margin="0 0 8px 0",U.style.fontSize="13px";const B=["Lowercase","Uppercase","Single Line","Manhwa Mode"],F=document.createElement("div");F.style.display="flex",F.style.flexDirection="column",F.style.gap="6px",B.forEach(e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.color="#e6eef8";const n=document.createElement("input");n.type="checkbox",n.id=`copy_${e.replace(/\s+/g,"_").toLowerCase()}`,n.style.width="16px",n.style.height="16px",n.style.accentColor="#4f46e5",n.style.cursor="pointer";const o=document.createElement("span");o.textContent=e,o.style.userSelect="none",t.appendChild(n),t.appendChild(o),F.appendChild(t)}),z.appendChild(P),z.appendChild(U),z.appendChild(F);const $=JSON.parse(localStorage.getItem("manhwa_autoSave")||"false"),J=document.createElement("div");J.style.display="flex",J.style.justifyContent="center",J.style.alignItems="center",J.style.gap="8px",J.style.marginTop="6px";const W=document.createElement("input");W.type="checkbox",W.id="autosave_chk",W.checked=$;const Y=document.createElement("label");Y.textContent="Auto-save",Y.style.color="#e6eef8",Y.style.fontSize="13px";const G=document.createElement("span");G.textContent=" ?",G.title="Automatically saves rule changes without needing to click Save",G.style.cursor="help",G.style.color="#9ca3af",G.style.fontSize="13px",J.appendChild(W),J.appendChild(Y),J.appendChild(G);const H=document.createElement("div");H.style.display="flex",H.style.justifyContent="center",H.style.marginTop="6px",H.style.alignItems="center",H.style.gap="8px";const K=document.createElement("button");K.textContent="Close & Save",Object.assign(K.style,{padding:"10px 14px",borderRadius:"8px",border:"none",background:"#4f46e5",color:"#fff",cursor:"pointer"});const q=document.createElement("div");function X(e){const n=document.createElement("div");n.textContent=e,Object.assign(n.style,{position:"fixed",bottom:"24px",left:"50%",transform:"translateX(-50%)",background:"#0b1220",color:"#e6eef8",padding:"8px 12px",borderRadius:"8px",border:"1px solid #25303a",zIndex:1000003,opacity:"0",transition:"opacity 160ms ease"}),t.appendChild(n),requestAnimationFrame(()=>n.style.opacity="1"),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),300)},1800)}q.style.color="#9ca3af",q.style.fontSize="13px",q.style.display="none",q.textContent="",H.appendChild(q),H.appendChild(K),m.appendChild(g),m.appendChild(z),m.appendChild(N),m.appendChild(J),m.appendChild(H),t.appendChild(m),W.addEventListener("change",()=>{try{localStorage.setItem("manhwa_autoSave",JSON.stringify(!!W.checked))}catch(e){}W.checked?(le(),oe(),X("Auto-save enabled: Changes are saved automatically")):X("Auto-save disabled")}),window.manhwaRules=window.manhwaRules||[],window.manhwaDeleteChars=window.manhwaDeleteChars||[];let V="global",Z=!1;function Q(e){return"manhwa_rules::"+encodeURIComponent(e)}function ee(e){return"manhwa_deletes::"+encodeURIComponent(e)}function te(){return document.getElementById("rule_scope")?document.getElementById("rule_scope").value:"global"}function ne(){Z=!0,q.style.display="inline-block",q.textContent="Unsaved"}function oe(){Z=!1,q.style.display="inline-block",q.textContent="Saved",setTimeout(()=>{Z||(q.style.display="none")},900)}function re(){L.innerHTML="",window.manhwaRules.forEach((e,t)=>{const n=document.createElement("div");n.style.display="flex",n.style.flexDirection="row",n.style.alignItems="center",n.style.justifyContent="space-between",n.style.padding="6px 8px",n.style.background="#071022",n.style.borderRadius="8px",n.style.minHeight="36px",n.style.boxSizing="border-box";const o=document.createElement("div");o.textContent=`${e.find} â†’ ${e.replace}`,o.style.color="#e6eef8",o.style.fontSize="14px",o.style.flex="1",o.style.marginRight="8px",o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis";const r=document.createElement("button");r.textContent="âœ•",Object.assign(r.style,{padding:"6px",borderRadius:"6px",border:"none",background:"#ef4444",color:"#fff",cursor:"pointer",marginLeft:"8px"}),r.addEventListener("click",()=>{!function(e){window.manhwaRules.splice(e,1),re(),W&&W.checked?le():ne()}(t)}),n.appendChild(o),n.appendChild(r),L.appendChild(n)})}function ae(){j.innerHTML="",window.manhwaDeleteChars.forEach((e,t)=>{const n=document.createElement("div");n.style.display="inline-flex",n.style.alignItems="center",n.style.gap="8px",n.style.padding="6px 8px",n.style.background="#07202a",n.style.color="#e6eef8",n.style.borderRadius="8px",n.style.border="1px solid rgba(255,255,255,0.03)";const o=document.createElement("span");o.textContent=e,o.style.fontSize="13px",o.style.marginRight="10px";const r=document.createElement("button");r.textContent="âœ•",Object.assign(r.style,{padding:"6px",borderRadius:"6px",border:"none",background:"#ef4444",color:"#fff",cursor:"pointer"}),r.addEventListener("click",()=>{!function(e){window.manhwaDeleteChars.splice(e,1),ae(),W&&W.checked?le():ne()}(t)}),n.appendChild(o),n.appendChild(r),j.appendChild(n)})}function ie(){const e=te()||"global";try{const e=new Set;e.add("global");for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n&&(n.startsWith("manhwa_rules::")||n.startsWith("manhwa_deletes::"))){const t=decodeURIComponent(n.split("::")[1]||"");if(t&&!e.has(t)){const n=document.createElement("option");n.value=t,n.textContent=t.startsWith("site:")?t.replace(/^site:/,""):t,d.appendChild(n),e.add(t)}}}}catch(e){}const t=localStorage.getItem(ee(e))||"[]";try{const e=JSON.parse(t);window.manhwaDeleteChars=Array.isArray(e)?e.slice():[]}catch(e){window.manhwaDeleteChars=[]}const n=localStorage.getItem(Q(e))||"[]";try{const e=JSON.parse(n);window.manhwaRules=Array.isArray(e)?e.map(e=>({find:String(e.find||""),replace:String(e.replace||"")})):[]}catch(e){window.manhwaRules=[]}const o=JSON.parse(localStorage.getItem("copyConfig")||"{}");B.forEach(e=>{const t=`copy_${e.replace(/\s+/g,"_").toLowerCase()}`,n=document.getElementById(t);n&&(n.checked=!!o[t])}),re(),ae(),V=e,oe()}function le(){const e=te()||"global";try{localStorage.setItem(ee(e),JSON.stringify(window.manhwaDeleteChars))}catch(t){localStorage.setItem(ee(e),JSON.stringify(window.manhwaDeleteChars||[]))}try{localStorage.setItem(Q(e),JSON.stringify(window.manhwaRules))}catch(t){localStorage.setItem(Q(e),JSON.stringify(window.manhwaRules||[]))}if("global"===e){try{localStorage.setItem("charsToDelete",JSON.stringify(window.manhwaDeleteChars))}catch(e){localStorage.setItem("charsToDelete",(window.manhwaDeleteChars||[]).join(""))}try{localStorage.setItem("replacementsText",JSON.stringify(window.manhwaRules))}catch(e){localStorage.setItem("replacementsText","[]")}}const t={};B.forEach(e=>{const n=`copy_${e.replace(/\s+/g,"_").toLowerCase()}`,o=document.getElementById(n);t[n]=!(!o||!o.checked)}),localStorage.setItem("copyConfig",JSON.stringify(t))}function se(n){n&&le(),t.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>{e.parentElement&&e.parentElement.removeChild(e),t.parentElement&&t.parentElement.removeChild(t),window.removeEventListener("keydown",de)},340)}function ce(){if(Z&&(!W||!W.checked)){const e=document.createElement("div");Object.assign(e.style,{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",background:"#0b1220",padding:"12px",borderRadius:"8px",border:"1px solid #25303a",zIndex:1000003});const n=document.createElement("div");n.textContent="You have unsaved changes. Save before closing?",n.style.marginBottom="8px",n.style.color="#e6eef8";const o=document.createElement("button");o.textContent="Save & Close",Object.assign(o.style,{marginRight:"8px",padding:"6px 8px",background:"#4f46e5",color:"#fff",border:"none",borderRadius:"6px"});const r=document.createElement("button");r.textContent="Discard & Close",Object.assign(r.style,{marginRight:"8px",padding:"6px 8px",background:"#ef4444",color:"#fff",border:"none",borderRadius:"6px"});const a=document.createElement("button");return a.textContent="Cancel",Object.assign(a.style,{padding:"6px 8px",background:"#374151",color:"#fff",border:"none",borderRadius:"6px"}),e.appendChild(n),e.appendChild(o),e.appendChild(r),e.appendChild(a),t.appendChild(e),o.addEventListener("click",()=>{e.remove(),se(!0)}),r.addEventListener("click",()=>{e.remove(),se(!1)}),void a.addEventListener("click",()=>{e.remove()})}se(!0)}function de(e){"Escape"===e.key&&ce()}_.addEventListener("click",()=>M.click()),M.addEventListener("change",e=>{const t=e.target.files&&e.target.files[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{const e=JSON.parse(n.result);if(e.manhwaDeleteChars&&(window.manhwaDeleteChars=e.manhwaDeleteChars.slice()),e.manhwaRules&&(window.manhwaRules=e.manhwaRules.map(e=>({find:e.find+"",replace:e.replace+""}))),e.charsToDelete&&!e.manhwaDeleteChars)try{const t=JSON.parse(e.charsToDelete);Array.isArray(t)?window.manhwaDeleteChars=t.slice():window.manhwaDeleteChars=(e.charsToDelete||"").split("")}catch{window.manhwaDeleteChars=(e.charsToDelete||"").split("")}if(e.replacementsText&&!e.manhwaRules)try{const t=JSON.parse(e.replacementsText);Array.isArray(t)&&(window.manhwaRules=t.slice())}catch{const t=(e.replacementsText||"").split(/\r?\n/).map(e=>e.trim()).filter(Boolean);window.manhwaRules=[],t.forEach(e=>{const t=e.indexOf("â†’")>=0?"â†’":e.indexOf("=>")>=0?"=>":null;if(t){const n=e.split(t);window.manhwaRules.push({find:n[0],replace:n.slice(1).join(t)})}})}e.copyConfig&&Object.keys(e.copyConfig).forEach(t=>{const n=document.getElementById(t);n&&(n.checked=!!e.copyConfig[t])}),re(),ae(),le(),alert("Imported settings")}catch(e){alert("Invalid settings file")}},n.readAsText(t),e.target.value=""}),D.addEventListener("click",()=>{const e={};try{for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n){if(n.startsWith("manhwa_rules::")){const t=decodeURIComponent(n.split("::")[1]||"");try{e[t]=e[t]||{},e[t].manhwaRules=JSON.parse(localStorage.getItem(n)||"[]")}catch(n){e[t].manhwaRules=[]}}if(n.startsWith("manhwa_deletes::")){const t=decodeURIComponent(n.split("::")[1]||"");try{e[t]=e[t]||{},e[t].manhwaDeleteChars=JSON.parse(localStorage.getItem(n)||"[]")}catch(n){e[t].manhwaDeleteChars=[]}}}}}catch(e){}const t={exportedAt:(new Date).toISOString(),scopes:e,copyConfig:JSON.parse(localStorage.getItem("copyConfig")||"{}")},n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="ocr-settings-all.json",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(o)}),r.addEventListener("click",()=>ce()),K.addEventListener("click",()=>{le(),oe(),se(!0)}),e.addEventListener("click",()=>ce()),window.addEventListener("keydown",de),document.body.appendChild(e),document.body.appendChild(t),requestAnimationFrame(()=>{e.style.opacity="1",t.style.transform="translateX(0)"}),ie();const pe=document.getElementById("rule_scope");pe.addEventListener("change",e=>{const t=pe.value;t!==V&&(confirm(`Switch rule scope to "${t}"?`)?(V=t,ie()):pe.value=V)}),y.addEventListener("click",()=>{const e=window.location&&window.location.origin?window.location.origin:window.location&&window.location.href?window.location.href:"current",t=`site:${e}`;if(!Array.from(pe.options).some(e=>e.value===t)){const n=document.createElement("option");n.value=t,n.textContent=e,pe.appendChild(n)}pe.value=t,V=t;try{localStorage.getItem(Q(t))||localStorage.setItem(Q(t),JSON.stringify([])),localStorage.getItem(ee(t))||localStorage.setItem(ee(t),JSON.stringify([]))}catch(e){}window.manhwaRules=[],window.manhwaDeleteChars=[],re(),ae(),le()}),h.addEventListener("click",()=>{const e=pe.value||"global";if("global"===e)return void alert("Cannot delete the Global scope.");if(!confirm(`Delete rules for scope "${e}"? This will remove saved rules for this site.`))return;try{localStorage.removeItem(Q(e)),localStorage.removeItem(ee(e))}catch(e){}const t=Array.from(pe.options).find(t=>t.value===e);t&&t.remove(),pe.value="global",V="global",ie(),alert("Scope deleted")}),k.addEventListener("click",()=>{const e=(v.value||"").trim(),t=(C.value||"").trim();if(!e||!t)return S.textContent="Both fields are required",void(S.style.display="block");S.style.display="none",window.manhwaRules.push({find:e,replace:t}),v.value="",C.value="",re(),W&&W.checked?le():ne()}),[v,C].forEach(e=>{e.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),k.click())})}),T.addEventListener("click",()=>{const e=(A.value||"").trim();e?(window.manhwaDeleteChars.push(e),A.value="",ae(),W&&W.checked?le():ne()):alert("Enter a character to delete")})}function a(){const e=function(e,t="32px",n="32px",o=null){const r=document.createElement("button");return r.textContent=e,r.style.width=t,r.style.height=n,r.style.padding="4px",r.style.backgroundColor="#374151",r.style.color="#9ca3af",r.style.border="1px solid #4b5563",r.style.borderRadius="6px",r.style.cursor="pointer",r.style.fontSize="16px",r.style.fontFamily="Inter, sans-serif",r.style.transition="all 0.2s ease",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#4b5563",r.style.transform="translateY(-1px)",r.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="#374151",r.style.transform="translateY(0)",r.style.boxShadow="none"}),r.addEventListener("mousedown",()=>{r.style.transform="translateY(1px) scale(0.98)"}),r.addEventListener("mouseup",()=>{r.style.transform="translateY(-1px)"}),o&&r.addEventListener("click",o),r}("âš™","32px","32px");return e.title="Settings",e.addEventListener("click",()=>{try{return void r()}catch(e){}try{if("undefined"!=typeof chrome&&chrome.tabs&&"function"==typeof chrome.tabs.create)return void chrome.tabs.create({url:chrome.runtime.getURL("settings.html"),active:!0})}catch(e){}window.dispatchEvent(new CustomEvent("ocr:openSettings"))}),e}function i(e,n){console.log("Showing popup with state:",e,"text:",n),document.querySelectorAll('div[style*="position: fixed"][style*="bottom: 10px"][style*="right: 10px"]').forEach(e=>{document.body.contains(e)&&document.body.removeChild(e)});const r=document.createElement("div");r.style.position="fixed",r.style.bottom="10px",r.style.right="10px",r.style.width="min(450px, 90vw)",r.style.backgroundColor="#1f2937",r.style.color="#f9fafb",r.style.border="1px solid #374151",r.style.borderRadius="12px",r.style.boxShadow="0 10px 25px rgba(0,0,0,0.3)",r.style.zIndex="1000000",r.style.fontFamily="Inter, sans-serif",r.style.padding="20px",r.style.maxHeight="min(500px, 80vh)",r.style.overflowY="auto";const i=document.createElement("div");i.className="progress-container",i.style.marginBottom="20px";const s=document.createElement("div");s.style.display="flex",s.style.alignItems="center";const c=document.createElement("label");c.textContent="Recognizing",c.style.width="100px",c.style.fontSize="14px",c.style.color="#9ca3af",s.appendChild(c);const d=document.createElement("div");d.style.flex="1",d.style.height="8px",d.style.backgroundColor="#374151",d.style.borderRadius="4px",d.style.overflow="hidden";const p=document.createElement("div");p.style.height="100%",p.style.backgroundColor="#4f46e5",p.style.width="0%",d.appendChild(p),s.appendChild(d),i.appendChild(s),r.appendChild(i);const u=document.createElement("div");u.style.position="relative",u.style.marginBottom="18px";const y=document.createElement("textarea");y.value=n,y.style.width="100%",y.style.height="120px",y.style.padding="12px",y.style.backgroundColor="#374151",y.style.color="#f9fafb",y.style.border="1px solid #4b5563",y.style.borderRadius="8px",y.style.resize="vertical",y.style.fontFamily="Inter, sans-serif",y.style.minHeight="32px",y.style.maxHeight="200px",u.appendChild(y);const h=document.createElement("div");h.style.display="flex",h.style.justifyContent="space-between",h.style.alignItems="center",h.style.marginBottom="8px";const m=document.createElement("select");["Korean","English","Turkish","Chinese"].forEach(e=>{const t=document.createElement("option");t.value=t.textContent=e,m.appendChild(t)}),Object.assign(m.style,{background:"#0b1220",color:"#e6eef8",border:"1px solid #25303a",borderRadius:"6px",padding:"6px",fontSize:"12px"});const g=a();Object.assign(g.style,{width:"34px",height:"34px",padding:"6px",borderRadius:"6px",background:"#374151"}),g.title="Settings",h.appendChild(m),h.appendChild(g),u.appendChild(h),u.appendChild(y),r.appendChild(u);const f=document.createElement("div");f.className="popup-footer",f.style.display="flex",f.style.justifyContent="center",f.style.alignItems="center",f.style.gap="0",f.style.padding="0",f.style.margin="0",f.style.width="100%";const x=document.createElement("div");x.style.display="flex",x.style.justifyContent="center",x.style.gap="8px",x.style.flexWrap="wrap",x.style.margin="0",x.style.padding="0",x.style.width="100%",x.style.boxSizing="border-box";const w=function(e){return t("Lower Case","120px","32px",()=>{const t=o(e.value);e.value=t.toLowerCase()})}(y);x.appendChild(w);const b=function(e){return t("Upper Case","120px","32px",()=>{e.value=e.value.toUpperCase()})}(y);x.appendChild(b);const v=function(e){return t("Single Line","120px","32px",()=>{const t=o(e.value);e.value=t.replace(/\n/g," ")})}(y);x.appendChild(v);const C=function(e){return t("Manhwa Mode","120px","32px",()=>{let t=e.value||"",n=[];try{window.manhwaDeleteChars&&Array.isArray(window.manhwaDeleteChars)&&(n=window.manhwaDeleteChars.slice())}catch(e){}if(0===n.length){const e=localStorage.getItem("charsToDelete")||"";try{const t=JSON.parse(e);n=Array.isArray(t)?t.slice():(e||"").split("")}catch{n=(e||"").split("")}}n.forEach(e=>{e&&(t=t.split(e).join(""))});let o=[];try{window.manhwaRules&&Array.isArray(window.manhwaRules)&&(o=window.manhwaRules.map(e=>({find:e.find+"",replace:e.replace+""})))}catch(e){}if(0===o.length){try{const e=window.location&&window.location.origin?window.location.origin:null;if(e){const t="manhwa_rules::"+encodeURIComponent("site:"+e),n=localStorage.getItem(t);if(n){const e=JSON.parse(n);Array.isArray(e)&&(o=e.map(e=>({find:String(e.find||""),replace:String(e.replace||"")})))}}}catch(e){}if(0===o.length){const e=localStorage.getItem("replacementsText")||"";try{const t=JSON.parse(e);if(Array.isArray(t))o=t.map(e=>({find:String(e.find||""),replace:String(e.replace||"")}));else{const t=String(e||"").split(/\r?\n/).map(e=>e.trim()).filter(Boolean),n=[];t.forEach(e=>{const t=e.indexOf("â†’")>=0?"â†’":e.indexOf("=>")>=0?"=>":null;if(t){const o=e.split(t);n.push({find:o[0],replace:o.slice(1).join(t)})}}),o=n}}catch(t){const n=String(e||"").split(/\r?\n/).map(e=>e.trim()).filter(Boolean),r=[];n.forEach(e=>{const t=e.indexOf("â†’")>=0?"â†’":e.indexOf("=>")>=0?"=>":null;if(t){const n=e.split(t);r.push({find:n[0],replace:n.slice(1).join(t)})}}),o=r}}}o.forEach(e=>{if(e&&e.find)try{const n=`(?<!\\w)${e.find.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(?!\\w)`,o=new RegExp(n,"gi");t=t.replace(o,e.replace||"")}catch(n){try{t=t.split(e.find).join(e.replace||"")}catch(e){}}}),e.value=t.replace(/\n/g," ").toLowerCase()})}(y);x.appendChild(C);const E=function(e,n){const o=t("Copy","120px","32px");return o.handler=async()=>(await n(e.value),!0),o.addEventListener("click",function(e){return async()=>{await e.handler()&&(e.textContent="Copied!",setTimeout(()=>e.textContent="Copy",2e3))}}(o)),o}(y,l);x.appendChild(E);const S=function(e){return function(e,n="110px",o="32px",r=null){const a=t("Close",n,o,r);return a.style.backgroundColor="#4f46e5",a.style.border="none",a.style.color="#ffffff",a.dataset.origBg=a.style.backgroundColor,a}(0,"120px","32px",()=>{document.body.removeChild(e)})}(r);function k(e){const t=`copy_${e.replace(/\s+/g,"_").toLowerCase()}`,n=document.getElementById(t);if(n)return!!n.checked;try{return!!JSON.parse(localStorage.getItem("copyConfig")||"{}")[t]}catch(e){return!1}}function L(){const e=document.createElement("div");e.textContent="Copied!",Object.assign(e.style,{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",background:"#0b1220",color:"#e6eef8",padding:"6px 10px",borderRadius:"6px",border:"1px solid #25303a",zIndex:1000002,opacity:"0",transition:"opacity 160ms ease"}),r.appendChild(e),requestAnimationFrame(()=>e.style.opacity="1"),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>e.remove(),220)},900)}return x.appendChild(S),w.addEventListener("click",async()=>{k("Lowercase")&&await l(y.value)&&L()}),b.addEventListener("click",async()=>{k("Uppercase")&&await l(y.value)&&L()}),v.addEventListener("click",async()=>{k("Single Line")&&await l(y.value)&&L()}),C.addEventListener("click",async()=>{k("Manhwa Mode")&&await l(y.value)&&L()}),f.appendChild(x),r.appendChild(f),"processing"===e?(i.style.display="block",y.style.display="none",f.style.display="none",r.intervalId=setInterval(()=>{let e=parseFloat(p.style.width)||0;e+=10,e>90&&(e=90),p.style.width=e+"%"},300)):(i.style.display="none",y.style.display="block",f.style.display="flex"),document.body.appendChild(r),r}async function l(e){try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0}catch(e){console.warn("Modern clipboard API failed, falling back to execCommand")}try{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch(e){return console.error("Clipboard copy failed:",e),!1}}let s,c,d,p;function u(){try{s&&document.body.contains(s)&&document.body.removeChild(s)}catch(e){}try{c&&document.body.contains(c)&&document.body.removeChild(c)}catch(e){}try{d&&document.body.contains(d)&&document.body.removeChild(d)}catch(e){}try{p&&document.body.contains(p)&&document.body.removeChild(p)}catch(e){}s=c=d=p=null}console.log("Content script loaded");try{!function(){if(document.getElementById("ocr-settings-fab"))return document.getElementById("ocr-settings-fab");const e=a();e.id="ocr-settings-fab",e.style.position="fixed",e.style.left="12px",e.style.bottom="12px",e.style.zIndex="1000002",e.style.boxShadow="0 8px 24px rgba(0,0,0,0.3)",e.style.borderRadius="8px",document.body.appendChild(e)}()}catch(e){console.warn("Could not create floating settings button:",e)}document.addEventListener("click",e=>{try{const t=e.target.closest&&e.target.closest("button");if(!t)return;if("ocr-settings-fab"!==t.id&&"Settings"!==t.title&&"âš™"!==t.textContent.trim())return;return e.stopImmediatePropagation(),e.preventDefault(),console.log("Settings click intercepted â€” opening panel"),void r()}catch(e){console.warn("Settings click interceptor error",e)}},!0);let y,h,m,g,f,x=!1;function w(e){y=e.clientX,h=e.clientY,f.style.left=y+"px",f.style.top=h+"px",f.style.width="0px",f.style.height="0px"}function b(e){if(!x||void 0===y)return;m=e.clientX,g=e.clientY;const t=Math.abs(m-y),n=Math.abs(g-h),o=Math.min(y,m),r=Math.min(h,g);f.style.left=o+"px",f.style.top=r+"px",f.style.width=t+"px",f.style.height=n+"px",function(e,t,n,o){if(!s||void 0===e)return;const r=Math.abs(n-e),a=Math.abs(o-t),i=Math.min(e,n),l=Math.min(t,o);s.style.height=l+"px",c.style.height=window.innerHeight-l-a+"px",d.style.width=i+"px",d.style.top=l+"px",d.style.height=a+"px",p.style.width=window.innerWidth-i-r+"px",p.style.top=l+"px",p.style.height=a+"px"}(y,h,m,g)}async function v(t){if(!x)return;m=t.clientX,g=t.clientY,document.removeEventListener("mousedown",w),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",v);try{u()}catch(e){console.error("Error removing overlay:",e)}try{f&&document.body.contains(f)&&document.body.removeChild(f)}catch(e){console.error("Error removing selectionDiv:",e)}const n=Math.abs(m-y),o=Math.abs(g-h);if(0===n||0===o)return x=!1,void(y=h=m=g=void 0);const r=Math.min(y,m),a=Math.min(h,g);try{const t=await browser.runtime.sendMessage({action:"captureViewport"});if(!t||!t.dataUrl)throw new Error("No capture data received");const l=new Image;l.src=t.dataUrl,await new Promise((e,t)=>{l.onload=e,l.onerror=t});const s=window.devicePixelRatio||1,c=Math.round(r*s),d=Math.round(a*s),p=Math.round(n*s),u=Math.round(o*s),y=document.createElement("canvas");y.width=p,y.height=u;const h=y.getContext("2d"),m=Math.max(0,Math.min(p,l.width-c)),g=Math.max(0,Math.min(u,l.height-d));h.drawImage(l,c,d,m,g,0,0,y.width,y.height);const f=i("processing","");console.log("Starting OCR...");const x=await async function(t){try{const n=await(0,e.createWorker)("eng"),{data:{text:o}}=await n.recognize(t);return await n.terminate(),o?o.trim():""}catch(e){throw console.error("OCR processing failed:",e),e}}(y);console.log("OCR result:",x),function(e,t){if(e.intervalId){clearInterval(e.intervalId);const t=e.querySelector('div[style*="backgroundColor: rgb(79, 70, 229)"]');t&&(t.style.width="100%")}const n=e.querySelector("textarea"),o=e.querySelector(".progress-container"),r=e.querySelector(".popup-footer");n&&(n.value=t),o&&(o.style.display="none"),n&&(n.style.display="block"),r&&(r.style.display="flex")}(f,x)}catch(e){console.error("OCR failed:",e),i("done","OCR processing failed")}x=!1,y=h=m=g=void 0}browser.runtime.onMessage.addListener(async e=>{console.log("Content script received message:",e),"startSelection"===e.action&&(x||(x=!0,u(),s=document.createElement("div"),s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height=window.innerHeight+"px",s.style.backgroundColor="rgba(213, 224, 58, 0.5)",s.style.zIndex="999998",document.body.appendChild(s),c=document.createElement("div"),c.style.position="fixed",c.style.bottom="0",c.style.left="0",c.style.width="100%",c.style.height="0",c.style.backgroundColor="rgba(213, 224, 58, 0.5)",c.style.zIndex="999998",document.body.appendChild(c),d=document.createElement("div"),d.style.position="fixed",d.style.top="0",d.style.left="0",d.style.width=window.innerWidth+"px",d.style.height=window.innerHeight+"px",d.style.backgroundColor="rgba(213, 224, 58, 0.5)",d.style.zIndex="999998",document.body.appendChild(d),p=document.createElement("div"),p.style.position="fixed",p.style.top="0",p.style.right="0",p.style.width="0",p.style.height=window.innerHeight+"px",p.style.backgroundColor="rgba(213, 224, 58, 0.5)",p.style.zIndex="999998",document.body.appendChild(p),f=document.createElement("div"),f.style.position="fixed",f.style.border="2px solid red",f.style.backgroundColor="rgba(255, 0, 0, 0.1)",f.style.pointerEvents="none",f.style.zIndex="1000001",document.body.appendChild(f),document.addEventListener("mousedown",w),document.addEventListener("mousemove",b),document.addEventListener("mouseup",v)))})})()})();