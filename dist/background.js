(()=>{var e={47(e,t,a){const n=a(432);function r(e){if(!e||"string"!=typeof e)return;if(n[e])return e;e=e.toLowerCase();const t=Object.keys(n);for(let a,r=0,o=t.length;r<o;r++)if(a=t[r],a.toLowerCase()===e||n[a].toLowerCase()===e)return a}e.exports={LANGS:n,getLangCode:r,isSupported:function(e){return!!r(e)}}},75(e){"use strict";e.exports=JSON.parse('{"ace":"Acehnese (Latin)","af":"Afrikaans","sq":"Albanian","am":"Amharic","ar":"Arabic","arz":"Arabic (Egyptian)","ary":"Arabic (Moroccan)","arb":"Arabic (Romanized)","hy":"Armenian","as":"Assamese","ast":"Asturian","az":"Azerbaijani","ban":"Balinese","bn":"Bangla","ba":"Bashkir","eu":"Basque","bbc":"Batak Toba","be":"Belarusian","bho":"Bhojpuri","bik":"Bikol","brx":"Bodo","bs":"Bosnian","bg":"Bulgarian","yue":"Cantonese (Traditional)","ca":"Catalan","ceb":"Cebuano","hne":"Chhattisgarhi","lzh":"Chinese (Literary)","zh-Hans":"Chinese Simplified","zh-Hant":"Chinese Traditional","co":"Corsican","hr":"Croatian","cs":"Czech","da":"Danish","prs":"Dari","dv":"Divehi","doi":"Dogri","nl":"Dutch","en":"English","en-GB":"English (United Kingdom)","epo":"Esperanto","et":"Estonian","fo":"Faroese","fj":"Fijian","fil":"Filipino","fi":"Finnish","fr":"French","fr-CA":"French (Canada)","fy":"Frisian","fur":"Friulian","gl":"Galician","lug":"Ganda","ka":"Georgian","de":"German","el":"Greek","gu":"Gujarati","ht":"Haitian Creole","ha":"Hausa","he":"Hebrew","hil":"Hiligaynon","hi":"Hindi","mww":"Hmong Daw","hu":"Hungarian","iba":"Iban","is":"Icelandic","ig":"Igbo","ilo":"Ilocano","id":"Indonesian","ikt":"Inuinnaqtun","iu":"Inuktitut","iu-Latn":"Inuktitut (Latin)","ga":"Irish","it":"Italian","jam":"Jamaican Patois","ja":"Japanese","jav":"Javanese","kea":"Kabuverdianu","kn":"Kannada","pam":"Kapampangan","ks":"Kashmiri","kk":"Kazakh","km":"Khmer","rw":"Kinyarwanda","tlh-Latn":"Klingon (Latin)","gom":"Konkani","ko":"Korean","kri":"Krio","ku":"Kurdish (Central)","kmr":"Kurdish (Northern)","ky":"Kyrgyz","lo":"Lao","la":"Latin","lv":"Latvian","lij":"Ligurian (Genoese)","lim":"Limburgish","ln":"Lingala","lt":"Lithuanian","lmo":"Lombard","dsb":"Lower Sorbian","lb":"Luxembourgish","mk":"Macedonian","mai":"Maithili","mg":"Malagasy","ms":"Malay","ml":"Malayalam","mt":"Maltese","mr":"Marathi","mwr":"Marwari","mfe":"Mauritian Creole","min":"Minangkabau (Latin)","mn-Cyrl":"Mongolian (Cyrillic)","mn-Mong":"Mongolian (Traditional)","my":"Myanmar (Burmese)","mi":"Māori","ne":"Nepali","nb":"Norwegian","nno":"Norwegian Nynorsk","nya":"Nyanja","oc":"Occitan","or":"Odia","pap":"Papiamento","ps":"Pashto","fa":"Persian","pl":"Polish","pt":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)","pa":"Punjabi","pnb":"Punjabi (Shahmukhi)","otq":"Querétaro Otomi","ro":"Romanian","run":"Rundi","ru":"Russian","sm":"Samoan","sa":"Sanskrit","srd":"Sardinian","sr-Cyrl":"Serbian (Cyrillic)","sr-Latn":"Serbian (Latin)","st":"Sesotho","nso":"Sesotho sa Leboa","tn":"Setswana","crs":"Seychelles French Creole","sn":"Shona","scn":"Sicilian","sd":"Sindhi","si":"Sinhala","sk":"Slovak","sl":"Slovenian","so":"Somali","es":"Spanish","su":"Sundanese","sw":"Swahili","sv":"Swedish","ty":"Tahitian","tgk":"Tajik","ta":"Tamil","tt":"Tatar","te":"Telugu","tet":"Tetum","th":"Thai","bo":"Tibetan","ti":"Tigrinya","tpi":"Tok Pisin","to":"Tongan","tr":"Turkish","tk":"Turkmen","uk":"Ukrainian","hsb":"Upper Sorbian","ur":"Urdu","ug":"Uyghur","uz":"Uzbek (Latin)","vec":"Venetian","vi":"Vietnamese","war":"Waray","cy":"Welsh","xh":"Xhosa","ydd":"Yiddish (Eastern)","yo":"Yoruba","yua":"Yucatec Maya","zu":"Zulu"}')},80(e,t,a){const n={"auto-detect":"Auto-detect",...a(75)},{correctableLangs:r}=a(317);function o(e){if(!e||"string"!=typeof e)return;if(n[e])return e;e=e.toLowerCase();const t=Object.keys(n);for(let a,r=0,o=t.length;r<o;r++)if(a=t[r],a.toLowerCase()===e||n[a].toLowerCase()===e)return a}e.exports={LANGS:n,getLangCode:o,isSupported:function(e){return!!o(e)},isCorrectable:function(e){return r.includes(o(e))}}},218(e,t,a){const n=a(684),r=a(80),o=a(317),s="https://{s}bing.com",i=s+o.websiteEndpoint,l=s+o.translateEndpoint,c=s+o.spellCheckEndpoint;let u,d;function h(e,t){return e.replace("{s}",t?t+".":"")}async function g(e,t){let a=u&&u.subdomain;try{const{body:r,request:{redirects:[s]}}=await n.get(h(i,a),{headers:{"user-agent":e||o.userAgent},agent:t,retry:{limit:3,methods:["GET"]},http2:!0});s&&(a=s.match(/^https?:\/\/(\w+)\.bing\.com/)[1]);const l=r.match(/IG:"([^"]+)"/)[1],c=r.match(/data-iid="([^"]+)"/)[1],[d,g,m]=JSON.parse(r.match(/params_AbusePreventionHelper\s?=\s?([^\]]+\])/)[1]),p={IG:l,IID:c,key:d,token:g,tokenTs:d,tokenExpiryInterval:m};return Object.entries(p).forEach(([e,t])=>{if(!t)throw new Error(`failed to fetch required field: \`${e}\``)}),u={...p,subdomain:a,count:0}}catch(e){throw console.error("failed to fetch global config"),e}}function m(e,t){const{IG:a,IID:n,subdomain:r}=u;return h(e?c:l,r)+"&IG="+a+"&IID="+n+(e||t?"&SFX="+ ++u.count:"")+(e||!t?"":"&ref=TThis&edgepdftranslator=1")}function p(e,t,a,n){const{token:r,key:o}=u,s={fromLang:a,text:t,token:r,key:o};return e||n&&(s.to=n),s}async function b(e){let t,a,n;try{t=await e}catch(e){t=(a=e).response}const r=t.body;if(r.ShowCaptcha?n="Sorry that bing translator seems to be asking for the captcha, please take care not to request too frequently.":401===r.StatusCode||401===t.statusCode?n="Translation limit exceeded. Please try it again later.":r.statusCode&&(n="Something went wrong!"),n){const e=`Response status: ${t.statusCode} (${t.statusMessage})\nResponse body  : ${JSON.stringify(r)}`;throw new Error(n+"\n"+e)}if(a){const e=new Error("Failed to request translation service");throw e.stack+="\n"+a.stack,e}return t}e.exports={translate:async function(e,t,a,s,l,c,f){if(!e||!(e=e.trim()))return;d||(d=g(c,f)),await d,function(){if(!u)return!0;const{tokenTs:e,tokenExpiryInterval:t}=u;return Date.now()-e>t}()&&(d=g(c,f)),await d,t=t||"auto-detect",a=a||"en";const w=r.isSupported(t),y=r.isSupported(a);if(!w||!y)throw new Error(`The language '${w?y?"":a:t}' is not supported!`);t=r.getLangCode(t),"auto-detect"===(a=r.getLangCode(a))&&(a="en");const k=e.length<=o.maxEPTTextLen&&[t,a].every(e=>"auto-detect"===e||o.eptLangs.includes(e));if(!k){const t="cn"===u.subdomain?o.maxTextLenCN:o.maxTextLen;if(e.length>t)throw new Error(`The supported maximum text length is ${t}. Please shorten the text.`)}const T=m(!1,k),L=p(!1,e,t,a);L.tryFetchingGenderDebiasedTranslations=!0;const x={"user-agent":c||o.userAgent,referer:h(i,u.subdomain)},S={limit:3,methods:["POST"]};let{body:C,headers:v}=await b(n.post(T,{headers:x,form:L,responseType:"text",agent:f,retry:k?0:S,http2:!0}));const A={text:e,userLang:t};if(v["content-type"].includes("application/json")){C=JSON.parse(C);const e=C[0].translations[0],t=C[0].detectedLanguage||{};A.translation=e.text,A.language={from:t.language,to:e.to,score:t.score}}else if(v.isgenderdebiasedtranslation){L.isGenderDebiasViewPresent=!0;const e=await b(n.post(T,{headers:x,form:L,responseType:"json",agent:f,retry:k?0:S,http2:!0}));C=e.body,A.translation=C.masculineTranslation,A.feminineTranslation=C.feminineTranslation,A.masculineTranslation=C.masculineTranslation,A.language={from:e.headers.detectedlanguage,to:a,score:void 0}}if(s){const t=A.language.from,a=e.match(/"/g);if(e.length+(a&&a.length||0)<=o.maxCorrectableTextLen&&r.isCorrectable(t)){const a=m(!0,k),r=p(!0,e,t),{body:o}=await b(n.post(a,{headers:x,form:r,responseType:"json",agent:f,retry:S,http2:!0}));A.correctedText=o&&o.correctedText}else console.warn(`The detected language '${t}' is not supported to be corrected or the length of text is more than ${o.maxCorrectableTextLen}.`)}return l&&(A.raw=C),A},lang:r,MET:a(500)}},317(e){"use strict";e.exports=JSON.parse('{"websiteEndpoint":"/translator","translateEndpoint":"/ttranslatev3?isVertical=1&","spellCheckEndpoint":"/tspellcheckv3?isVertical=1&","maxTextLen":1000,"maxTextLenCN":5000,"maxCorrectableTextLen":50,"maxEPTTextLen":3000,"correctableLangs":["da","en","nl","fi","fr","fr-CA","de","it","ja","ko","no","pl","pt","pt-PT","ru","es","sv","tr","zh-Hant","zh-Hans"],"eptLangs":["af","sq","am","ar","hy","az","bn","bs","bg","ca","zh-Hans","zh-Hant","hr","cs","da","prs","nl","en","et","fil","fi","fr","de","el","gu","ht","he","hi","hu","is","id","iu","ga","it","ja","kn","kk","km","ko","ku","lo","lv","lt","mg","ms","ml","mt","mr","my","mi","ne","nb","or","ps","fa","pl","pt","pt-PT","pa","ro","ru","sm","sr-Cyrl","sr-Latn","sk","sl","es","sw","sv","ta","te","th","to","tr","uk","ur","vi","cy"],"userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0"}')},432(e){"use strict";e.exports=JSON.parse('{"af":"Afrikaans","am":"Amharic","ar":"Arabic","as":"Assamese","az":"Azerbaijani","ba":"Bashkir","be":"Belarusian","bg":"Bulgarian","bho":"Bhojpuri","bn":"Bangla","bo":"Tibetan","brx":"Bodo","bs":"Bosnian","ca":"Catalan","cs":"Czech","cy":"Welsh","da":"Danish","de":"German","doi":"Dogri","dsb":"Lower Sorbian","dv":"Divehi","el":"Greek","en":"English","es":"Spanish","et":"Estonian","eu":"Basque","fa":"Persian","fi":"Finnish","fil":"Filipino","fj":"Fijian","fo":"Faroese","fr":"French","fr-CA":"French (Canada)","ga":"Irish","gl":"Galician","gom":"Konkani","gu":"Gujarati","ha":"Hausa","he":"Hebrew","hi":"Hindi","hne":"Chhattisgarhi","hr":"Croatian","hsb":"Upper Sorbian","ht":"Haitian Creole","hu":"Hungarian","hy":"Armenian","id":"Indonesian","ig":"Igbo","ikt":"Inuinnaqtun","is":"Icelandic","it":"Italian","iu":"Inuktitut","iu-Latn":"Inuktitut (Latin)","ja":"Japanese","ka":"Georgian","kk":"Kazakh","km":"Khmer","kmr":"Kurdish (Northern)","kn":"Kannada","ko":"Korean","ks":"Kashmiri","ku":"Kurdish (Central)","ky":"Kyrgyz","lb":"Luxembourgish","ln":"Lingala","lo":"Lao","lt":"Lithuanian","lug":"Ganda","lv":"Latvian","lzh":"Chinese (Literary)","mai":"Maithili","mg":"Malagasy","mi":"Māori","mk":"Macedonian","ml":"Malayalam","mn-Cyrl":"Mongolian (Cyrillic)","mn-Mong":"Mongolian (Traditional)","mni":"Manipuri","mr":"Marathi","ms":"Malay","mt":"Maltese","mww":"Hmong Daw","my":"Myanmar (Burmese)","nb":"Norwegian","ne":"Nepali","nl":"Dutch","nso":"Sesotho sa Leboa","nya":"Nyanja","or":"Odia","otq":"Querétaro Otomi","pa":"Punjabi","pl":"Polish","prs":"Dari","ps":"Pashto","pt":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)","ro":"Romanian","ru":"Russian","run":"Rundi","rw":"Kinyarwanda","sd":"Sindhi","si":"Sinhala","sk":"Slovak","sl":"Slovenian","sm":"Samoan","sn":"Shona","so":"Somali","sq":"Albanian","sr-Cyrl":"Serbian (Cyrillic)","sr-Latn":"Serbian (Latin)","st":"Sesotho","sv":"Swedish","sw":"Swahili","ta":"Tamil","te":"Telugu","th":"Thai","ti":"Tigrinya","tk":"Turkmen","tlh-Latn":"Klingon (Latin)","tlh-Piqd":"Klingon (pIqaD)","tn":"Setswana","to":"Tongan","tr":"Turkish","tt":"Tatar","ty":"Tahitian","ug":"Uyghur","uk":"Ukrainian","ur":"Urdu","uz":"Uzbek (Latin)","vi":"Vietnamese","xh":"Xhosa","yo":"Yoruba","yua":"Yucatec Maya","yue":"Cantonese (Traditional)","zh-Hans":"Chinese Simplified","zh-Hant":"Chinese Traditional","zu":"Zulu"}')},500(e,t,a){const n=a(684),r=a(47),{userAgent:o}=a(317);let s,i;async function l(e){try{const t=await n("https://edge.microsoft.com/translate/auth",{headers:{"User-Agent":e||o}}).text(),a=JSON.parse(Buffer.from(t.split(".")[1],"base64").toString("utf-8"));s={token:t,tokenExpiresAt:1e3*a.exp}}catch(e){throw console.error("failed to fetch auth token"),e}}e.exports={translate:async function(e,t,a,c){if(!e||!e.length)return;t&&"auto-detect"===t.toLocaleLowerCase()&&(t=void 0),t=r.getLangCode(t),Array.isArray(a)||(a=[a]),(a=a.map(e=>r.getLangCode(e)||"en")).length||(a=["en"]);const u=!t||r.isSupported(t),d=a.every(r.isSupported);if(!u||!d)throw new Error(`Unsupported language(s): ${u?d?"":a.map(e=>`'${e}'`).join(", "):`'${t}'`}`);Array.isArray(e)||(e=[e]),c||={};const h=c.authenticationHeaders;h||(i||(i=l(c.userAgent)),await i,(!s||(s.tokenExpiresAt||0)-Date.now()<6e4)&&(i=l(c.userAgent)),await i);const g=Object.assign({},c.gotOptions),m=g.headers||{};delete g.headers;const p=e.map(e=>({Text:e}));try{const{body:e}=await n.post("https://api.cognitive.microsofttranslator.com/translate",{searchParams:new URLSearchParams([...a.map(e=>["to",e]),...Object.entries({"api-version":"3.0",from:t,...c.translateOptions||{}}).filter(([e,t])=>null!=t&&""!==t)]),json:p,headers:{"User-Agent":o,Authorization:h?void 0:"Bearer "+s.token,...h||{},...m},responseType:"json",...g});return e}catch(e){let t;if(e instanceof n.RequestError){const a=e.response,n=JSON.stringify(a.body,null,2);t=` with a status code: ${a.statusCode} (${a.statusMessage})\n${n}\n`}else t=`: ${e.message}`;throw new Error(`failed to translate${t}`)}},lang:r}},684(e){async function t(e,t={}){console.log("got-shim: Request to",e,"with options:",t);const a=(t.method||"GET").toUpperCase(),n={},r=new URL(e);let o;if(t.searchParams&&(t.searchParams instanceof URLSearchParams?t.searchParams.forEach((e,t)=>r.searchParams.append(t,e)):Object.entries(t.searchParams).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>r.searchParams.append(e,t)):r.searchParams.append(e,t)})),t.body?o=t.body:t.form?(o=new URLSearchParams(t.form).toString(),n["content-type"]="application/x-www-form-urlencoded"):t.json&&(o=JSON.stringify(t.json),n["content-type"]="application/json"),t.headers){const e=["user-agent","accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","te","trailer","transfer-encoding","upgrade","via"];for(const[a,r]of Object.entries(t.headers))e.includes(a.toLowerCase())||(n[a]=r)}const s=await fetch(r.toString(),{method:a,headers:n,body:o,mode:"cors",credentials:"omit",redirect:"follow"});if(console.log("got-shim: Response status:",s.status,s.statusText),console.log("got-shim: Response headers:",Object.fromEntries(s.headers.entries())),!s.ok){const e=await s.text();console.error("HTTP Error:",s.status,s.statusText),console.error("Error response body (first 500):",e.substring(0,500));const t=new Error(`Request failed with status code ${s.status}`);throw t.response={statusCode:s.status,statusMessage:s.statusText,body:e},t}const i=await s.text();console.log("got-shim: Response text (first 200 chars):",i.substring(0,200));let l=i;if("json"===t.responseType)try{l=JSON.parse(i),console.log("got-shim: Parsed JSON successfully")}catch(e){console.error("JSON parse error:",e.message),console.error("Response text (first 500 chars):",i.substring(0,500))}else console.log("got-shim: Returning as text (responseType:",t.responseType,")");return{body:l,statusCode:s.status,statusMessage:s.statusText,headers:Object.fromEntries(s.headers.entries()),request:{redirects:s.redirected?[s.url]:[]},url:s.url}}t.get=(e,a)=>t(e,{...a,method:"GET"}),t.post=(e,a)=>t(e,{...a,method:"POST"}),e.exports=t}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=a(218);async function t(e){try{const t=await browser.tabs.get(e);if(!t.url||t.url.startsWith("about:")||t.url.startsWith("moz-extension:"))return void browser.contextMenus.update("quick-add-domain",{visible:!1});const a=new URL(t.url).hostname,{floating_button_mode:n,floating_button_blacklist:r,floating_button_whitelist:o}=await browser.storage.local.get(["floating_button_mode","floating_button_blacklist","floating_button_whitelist"]),s=o||[];let i="";i="blacklist"===(n||"blacklist")?(r||[]).includes(a)?`Remove ${a} from Blacklist`:`Block Floating Button on ${a}`:s.includes(a)?`Remove ${a} from Whitelist`:`Show Floating Button on ${a}`,browser.contextMenus.update("quick-add-domain",{title:i,visible:!0})}catch(e){browser.contextMenus.update("quick-add-domain",{visible:!1})}}function n(e){const t="active"===e?{16:"icons/active/icon16.png",32:"icons/active/icon32.png",48:"icons/active/icon48.png",128:"icons/active/icon128.png"}:{16:"icons/icon16.jpeg",32:"icons/icon32.jpeg",48:"icons/icon48.jpeg",128:"icons/icon128.jpeg"};browser.browserAction.setIcon({path:t})}console.log("OCR Extension background script loaded"),browser.contextMenus.create({id:"open-settings",title:"Open Settings",contexts:["browser_action"]},()=>{browser.runtime.lastError}),browser.contextMenus.create({id:"quick-add-domain",title:"Quick Add Domain (Loading...)",contexts:["all"]},()=>{browser.runtime.lastError}),browser.tabs.onActivated.addListener(e=>t(e.tabId)),browser.tabs.onUpdated.addListener((e,a,n)=>{"complete"===a.status&&t(e)}),browser.contextMenus.onClicked.addListener(async(e,a)=>{if("open-settings"===e.menuItemId&&browser.runtime.openOptionsPage(),"quick-add-domain"===e.menuItemId){const e=new URL(a.url).hostname,{floating_button_mode:n,floating_button_blacklist:r,floating_button_whitelist:o}=await browser.storage.local.get(["floating_button_mode","floating_button_blacklist","floating_button_whitelist"]);if("blacklist"===(n||"blacklist")){const t=r||[];if(t.includes(e)){const a=t.filter(t=>t!==e);await browser.storage.local.set({floating_button_blacklist:a})}else t.push(e),await browser.storage.local.set({floating_button_blacklist:t})}else{const t=o||[];if(t.includes(e)){const a=t.filter(t=>t!==e);await browser.storage.local.set({floating_button_whitelist:a})}else t.push(e),await browser.storage.local.set({floating_button_whitelist:t})}t(a.id)}}),browser.commands.onCommand.addListener(async e=>{if("activate-ocr"===e){const e=await browser.tabs.query({active:!0,currentWindow:!0});e.length>0&&(n("active"),browser.tabs.sendMessage(e[0].id,{action:"startSelection"}))}"open-settings"===e&&browser.runtime.openOptionsPage()}),browser.browserAction.onClicked.addListener(async e=>{console.log("Extension icon clicked for tab",e.id),n("active"),browser.tabs.sendMessage(e.id,{action:"startSelection"})});const r={};browser.runtime.onMessage.addListener(async(t,a)=>{if(t&&"selectionExited"===t.action&&n("default"),t&&"captureViewport"===t.action)try{return{dataUrl:await browser.tabs.captureVisibleTab(a.tab.windowId,{format:"png"})}}catch(e){throw console.error("captureVisibleTab failed:",e),e}if(t&&"translate"===t.action){const{text:a,from:n,to:o}=t;if(console.log("[Background] Translation request received:",{from:n||"auto",to:o||"en",textLength:a?.length}),!a)return console.log("[Background] Empty text, returning null"),{error:"Empty text"};const s=`${n||"auto"}_${o||"en"}_${a.trim()}`;if(r[s])return console.log("[Background] Translation cache hit"),r[s];try{console.log("[Background] Calling translate API...");const t=await(0,e.translate)(a,n||null,o||"en");console.log("[Background] Translation API response:",t);const i={translatedText:t.translation,detectedSource:t.language?t.language.from:null};r[s]=i;const l=Object.keys(r);return l.length>100&&delete r[l[0]],console.log("[Background] Returning translation result"),i}catch(e){return console.error("[Background] Translation failed:",e),console.error("[Background] Error details:",e.message),e.stack&&console.error("[Background] Stack:",e.stack),{error:e.message||"Translation failed",details:e.toString()}}}})})()})();