(()=>{function e(e){const n="active"===e?{16:"icons/active/icon16.png",32:"icons/active/icon32.png",48:"icons/active/icon48.png",128:"icons/active/icon128.png"}:{16:"icons/icon16.jpeg",32:"icons/icon32.jpeg",48:"icons/icon48.jpeg",128:"icons/icon128.jpeg"};browser.browserAction.setIcon({path:n})}console.log("OCR Extension background script loaded"),browser.contextMenus.create({id:"open-settings",title:"Open Settings",contexts:["browser_action"]},()=>{browser.runtime.lastError&&console.log(browser.runtime.lastError.message)}),browser.contextMenus.onClicked.addListener((e,n)=>{"open-settings"===e.menuItemId&&browser.runtime.openOptionsPage()}),browser.commands.onCommand.addListener(async n=>{if("activate-ocr"===n){const n=await browser.tabs.query({active:!0,currentWindow:!0});n.length>0&&(e("active"),browser.tabs.sendMessage(n[0].id,{action:"startSelection"}))}"open-settings"===n&&browser.runtime.openOptionsPage()}),browser.browserAction.onClicked.addListener(async n=>{console.log("Extension icon clicked for tab",n.id),e("active"),browser.tabs.sendMessage(n.id,{action:"startSelection"})}),browser.runtime.onMessage.addListener(async(n,o)=>{if(n&&"selectionExited"===n.action&&e("default"),n&&"captureViewport"===n.action)try{return{dataUrl:await browser.tabs.captureVisibleTab(o.tab.windowId,{format:"png"})}}catch(e){throw console.error("captureVisibleTab failed:",e),e}})})();